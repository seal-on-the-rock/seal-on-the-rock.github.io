---
layout: post
title: "article0005-LAMP"
date: 2025-10-23
author: Seal
---


# ☁️ article0005　LAMP

久しぶりです。

今日はよくあるフレームワーク　LAMP　の構成を紹介します。

先ずは、LAMPとは何ですか？

LAMP　＝　Linux　＋　Apache　＋　MySQL　＋　PHP　という現代よく使っているWEBシステムの構成フレームワークです。

Linux、MySQLとPHPは置いておいて、先ずはApacheを見てみましょう。

Apache ＝　Apache HTTP Serverです。あれ！server？そうですよね、先ずはApacheはHTTP関連Webシステムに向けてのサービスです。

一方で、AWS　＝　Amazon Web Servicesとのことです。AWSとApacheは同じにサービスとなっています。

しかも、昔Apacheを使って構築されたWebアプリケーションは今の時代でAWSの各サービスで組み立て構築することになります。

Apacheが果たす役割については、以下の主要な七つの機能です。

⑴　静的コンテンツを配信（Static Content）

　　HTMLファイル、画像（.jpg、.png）、CSS、JavaScriptなどそのまま提供する
  
  eg:seal-on-the-rockは僕のAWS技術ブログですが、homeのウェブページはindex.htmlというファイルでそのまま提供させて皆さんが見えるようになりました。
     
  そのindex.htmlファイルで、HTMLがあってCSSがあって、logoのイメージもあって文章のリストを生成するためのJavaScriptもあります。

<br><br>

つまり、静的コンテンツの配達員です！

<img src="/assets/images/0005-2.png" alt="StaticContent" class="responsive-img">

<br><br>

⑵　動的コンテンツの実行

　　Apache自身はプログラムの実行をしませんが、PHPへ渡します。

  <br><br>

  つまり、接客員です！
　　
<img src="/assets/images/0005-3.png" alt="ApacheToPHP" class="responsive-img">

<br><br>

⑶　逆プロキシReverse Proxy/Load Balancer

　　　⑵のように、Apacheは、ユーザーからのリクエストを別のサーバーやアプリケーションへ転送しています。
   
   これによって、下記の役割を果たします。
       
   ❶ バックエンドのアプリを隠す
           
   ❷ 複数のサーバーへ負荷分散
              
   ❸　SSLの終端になる（HTTPSを解析）

<br><br>              

  　つまり、交通指導員です！

<img src="/assets/images/0005-4.png" alt="ApacheToServer" class="responsive-img">

<br><br>

⑷　セキュリティー・アクセス制御

   ❶　IPアドレスやユーザー名によっての制限。
   
   ❷　WAFの提供。PS：FW → IPアドレスとポート号を基準に通信を制御する。WAF → FWの上で、リクエストの中身を見て攻撃を防ぎます。
    
<br><br> 

つまり、入口のチェックマンです！

<img src="/assets/images/0005-5.png" alt="ApacheWAF" class="responsive-img">

<br><br> 

⑸　URLの書き換え、リダイレクト

つまり、案内員です！

<img src="/assets/images/0005-6.png" alt="rewrite redirect" class="responsive-img">

<br><br>

⑹　ログ・モニタリング（Logging & Monitoring）

   ❶　すべてのアクセスをaccess.logに記録
   
   ❷　すべてのエラーをerror.logに出力
   
   ❸　状態確認（稼働している接続数や負荷を確認）

   つまり、記録員です！

   <img src="/assets/images/0005-7.png" alt="log monitoring" class="responsive-img">
   
<br><br> 

⑺　Virtual Host

１台のサーバーで複数のサーバーを運用できます。

つまり、不動産の管理者です！

<img src="/assets/images/0005-8.png" alt="virtual host" class="responsive-img">

<br><br>

---

さぁ、これまで、なんか上記のApacheの機能はAWSでそれに対して似ているサービスがあるのを感じていますか？

そうですね。Apache機能の実現は色んなモジュールに頼ります。一方で、AWSの色んなサービスを組み合わせて同じ機能を実現できます。

<img src="/assets/images/0005-1.png" alt="ApacheToAWS" class="responsive-img">

続いて、従来のLAMPウェブページと現在のAWS上のウェブページを比較しましょう。

先ずは、従来のLAMPウェブページの構成図は下記の通りです。

<img src="/assets/images/0005-9.png" alt="LAMP" class="responsive-img">

補充説明：

⑴　「apache2.serviceがHTTPの入口である」というのはapache2.serviceがHTTPリクエストの最前端コンポーネントということを指します。

⑵　LAMPの発展版はLNMPです。

　　　LNMP　＝　Linux　＋　Nginx　＋　MySQL　＋　PHP

⑶　HTTPリクエストが静的コンテンツであれば、Apacheが提供して返します。例えば；イメージ、HTML

　　HTTPリクエストが動的コンテンツであれば、ApacheがこのリクエストをPHPへ渡します。

　　多くな場合はデータベースのデータが必要ですから、MySQLにアクセスして、検索結果をMySQLから貰ってウェブページを生成します。

　　そしたら、Apacheが最終のウェブページをユーザーへ提供します。

  ※　Apacheがずっとコンテンツの提供者を担当しています。

  　　PHPプログラムがデータベースを利用して動的コンテンツの生成者。

---   

AWSの環境で、ウェブサイトの構築下記のようになります。

<img src="/assets/images/0005-10.png" alt="LAMP" class="responsive-img">

補充説明：

⑴　伝統LNMP構築にNginxの各機能はほとんどAWSが取って代わることができます。

ただ、いくつかの機能は取って代わられないです。

| Nginx機能 | 対応AWSサービス | 取って代わられるか |
|:----------------------------|:------------------------------|:-------|
| 逆プロキシ | API　Gateway/ALB/CloudFront| 可|
| 負荷分散 | ALB/NLB |可|
| 静的コンテンツ配信  | CloudFront | 可|
| SSL終端 | ACM＋ALB/CloudFront | 可|
| ウェブサーバー（動的コンテンツの実行） | 自分でアプリケーション環境の定義が必要 | 不可|
| URLリライト/複雑なルーティング | 自分で規則の定義が必要 | 不可|

AWSは「インフラ層」を担当し、Nginxは「アプリケーション層」を担当します。

AWSが提供しているのは「プラットフォーム（舞台）」です。

つまり、

•　負荷分散
•　証明書管理（SSL/TLS）
•　静的ファイルの配信（S3など）
•　DNS
•　自動スケーリング

と言ったインフラレベルの機能はすべてAWSが面倒を見てくらます。

しかし、AWSは「具体的にどんなHTMLを返すか」「どんなビジネスロジックを実行するか」と言ったアプリケーション中身（中の演出）まではやってくれません。

つまりこういう関係です：

```text
AWS　＝　舞台を用意してくれる

Nginx　＝　舞台の上で最初に動く俳優（HTTPリクエストを受け取る役）
```

またはこういう説明も適切です：

```text
AWSは「土台」と「道路」を整える

その上で走る「車」（＝Webサーバー）がNginx。
```

NginxがHTTPリクエストを受け取り、

PHP-FPM（などのアプリケーション実行プロセス）がサーバー上コードを実行し、その結果をNginxがクライアントに返します。





